<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
    <title>Helios AI</title>
    <meta name="description" content="Verwalten und analysieren Sie Ihre Pionex Trading-Bot Gewinne mit detaillierten Statistiken und Berichten." />
    <link rel="icon" type="image/png" href="/favicon.png" />
    <!-- PWA Manifest fÃ¼r iOS Native Push -->
    <link rel="manifest" href="/manifest.json" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Helios AI" />
    <link rel="apple-touch-icon" href="/icon-192.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">
  </head>
  <body>
    <!-- Splash Screen -->
    <div id="splash" style="position:fixed;top:0;left:0;width:100%;height:100%;z-index:9999;background:#fff;">
      <!-- CSS Animation Layer -->
      <div id="splash-css" style="position:absolute;top:0;left:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:#fff;">
        <img src="/splash-logo.png" alt="Helios AI" style="width:200px;height:200px;opacity:0;animation:splashPulse 2.5s ease-in-out forwards;" />
      </div>
      <!-- Video Layer (hidden initially) -->
      <div id="splash-video-wrapper" style="position:absolute;top:0;left:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:#fff;opacity:0;transition:opacity 0.3s;">
        <video id="splash-video" src="/splash-video.mp4" preload="auto" muted playsinline webkit-playsinline style="width:250px;height:250px;object-fit:contain;"></video>
      </div>
      <!-- Fallback Loading Spinner (hidden initially) -->
      <div id="splash-loading" style="position:absolute;top:0;left:0;width:100%;height:100%;display:none;flex-direction:column;align-items:center;justify-content:center;background:#fff;">
        <img src="/splash-logo.png" alt="Helios AI" style="width:120px;height:120px;margin-bottom:20px;" />
        <div style="width:40px;height:40px;border:3px solid #e5e7eb;border-top-color:#1e6091;border-radius:50%;animation:spin 1s linear infinite;"></div>
        <p style="margin-top:16px;color:#64748b;font-family:system-ui,sans-serif;font-size:14px;">Laden...</p>
      </div>
    </div>
    
    <style>
      @keyframes splashPulse {
        0% { opacity: 0; transform: scale(0.8); }
        20% { opacity: 1; transform: scale(1); }
        40% { transform: scale(1.05); }
        60% { transform: scale(1); }
        80% { transform: scale(1.05); }
        100% { transform: scale(1); opacity: 1; }
      }
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
    </style>
    
    <script>
      (function() {
        var splash = document.getElementById('splash');
        var splashCss = document.getElementById('splash-css');
        var videoWrapper = document.getElementById('splash-video-wrapper');
        var video = document.getElementById('splash-video');
        var splashLoading = document.getElementById('splash-loading');
        var isDashboard = window.location.pathname === '/' || window.location.pathname === '';
        var videoReady = false;
        var videoStarted = false;
        var videoFinished = false;
        var appReady = false;
        var splashRemoved = false;
        var minCssTime = 2500;
        var cssStartTime = Date.now();
        
        // Listen for app-ready event from React
        window.addEventListener('app-ready', function() {
          appReady = true;
          tryRemoveSplash();
        });
        
        function showLoadingSpinner() {
          splashCss.style.display = 'none';
          videoWrapper.style.display = 'none';
          splashLoading.style.display = 'flex';
        }
        
        function tryRemoveSplash() {
          if (splashRemoved) return;
          // Only remove when both: animation/video finished AND app ready
          if ((videoFinished || !isDashboard) && appReady) {
            splashRemoved = true;
            removeSplash();
          }
        }
        
        if (isDashboard) {
          // Dashboard: CSS + Video, then wait for app-ready
          video.addEventListener('canplay', function() {
            videoReady = true;
            tryStartVideo();
          });
          
          setTimeout(function() { tryStartVideo(); }, minCssTime);
          setTimeout(function() { tryStartVideo(); }, 5000);
          
          function tryStartVideo() {
            if (videoStarted) return;
            var elapsed = Date.now() - cssStartTime;
            if (elapsed >= minCssTime && (videoReady || elapsed >= 5000)) {
              videoStarted = true;
              splashCss.style.opacity = '0';
              splashCss.style.transition = 'opacity 0.3s';
              if (videoReady) {
                videoWrapper.style.opacity = '1';
                video.currentTime = 0;
                var playPromise = video.play();
                if (playPromise !== undefined) {
                  playPromise.catch(function() {
                    videoFinished = true;
                    onVideoFinished();
                  });
                }
              } else {
                videoFinished = true;
                onVideoFinished();
              }
            }
          }
          
          video.addEventListener('ended', function() {
            videoFinished = true;
            tryRemoveSplash();
            // Fallback: show spinner after 2s if app not ready
            setTimeout(function() {
              if (!appReady && !splashRemoved) {
                showLoadingSpinner();
              }
            }, 2000);
          });
          
        } else {
          // Other pages: CSS only, then wait for app-ready
          videoWrapper.style.display = 'none';
          setTimeout(function() {
            videoFinished = true;
            tryRemoveSplash();
            // Fallback: show spinner after 1s if app not ready
            setTimeout(function() {
              if (!appReady && !splashRemoved) {
                showLoadingSpinner();
              }
            }, 1000);
          }, minCssTime);
        }
        
        // Hard timeout: force remove after 15s no matter what
        setTimeout(function() {
          if (!splashRemoved) {
            splashRemoved = true;
            removeSplash();
          }
        }, 15000);
        
        function removeSplash() {
          if (splash && splash.parentNode) {
            splash.style.opacity = '0';
            splash.style.transition = 'opacity 0.5s';
            setTimeout(function() {
              splash.parentNode.removeChild(splash);
            }, 500);
          }
        }
      })();
    </script>
    
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
